-- create a tablespace we can use
CREATE TABLESPACE testspace LOCATION '@testtablespace@';
ERROR:  Postgres-XC does not support TABLESPACE yet
DETAIL:  The feature is not currently supported
-- try setting and resetting some properties for the new tablespace
ALTER TABLESPACE testspace SET (random_page_cost = 1.0);
ERROR:  tablespace "testspace" does not exist
ALTER TABLESPACE testspace SET (some_nonexistent_parameter = true);  -- fail
ERROR:  tablespace "testspace" does not exist
ALTER TABLESPACE testspace RESET (random_page_cost = 2.0); -- fail
ERROR:  tablespace "testspace" does not exist
ALTER TABLESPACE testspace RESET (random_page_cost, seq_page_cost); -- ok
ERROR:  tablespace "testspace" does not exist
-- create a schema we can use
CREATE SCHEMA testschema;
-- try a table
CREATE TABLE testschema.foo (i int) TABLESPACE testspace;
ERROR:  tablespace "testspace" does not exist
SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'foo';
 relname | spcname 
---------+---------
(0 rows)

INSERT INTO testschema.foo VALUES(1);
ERROR:  relation "testschema.foo" does not exist
LINE 1: INSERT INTO testschema.foo VALUES(1);
                    ^
INSERT INTO testschema.foo VALUES(2);
ERROR:  relation "testschema.foo" does not exist
LINE 1: INSERT INTO testschema.foo VALUES(2);
                    ^
-- tables from dynamic sources
CREATE TABLE testschema.asselect TABLESPACE testspace AS SELECT 1;
ERROR:  tablespace "testspace" does not exist
SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'asselect';
 relname | spcname 
---------+---------
(0 rows)

PREPARE selectsource(int) AS SELECT $1;
CREATE TABLE testschema.asexecute TABLESPACE testspace
    AS EXECUTE selectsource(2);
ERROR:  tablespace "testspace" does not exist
SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'asexecute';
 relname | spcname 
---------+---------
(0 rows)

-- index
CREATE INDEX foo_idx on testschema.foo(i) TABLESPACE testspace;
ERROR:  relation "testschema.foo" does not exist
SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'foo_idx';
 relname | spcname 
---------+---------
(0 rows)

-- let's try moving a table from one place to another
CREATE TABLE testschema.atable AS VALUES (1), (2);
CREATE UNIQUE INDEX anindex ON testschema.atable(column1);
ALTER TABLE testschema.atable SET TABLESPACE testspace;
ERROR:  tablespace "testspace" does not exist
ALTER INDEX testschema.anindex SET TABLESPACE testspace;
ERROR:  tablespace "testspace" does not exist
INSERT INTO testschema.atable VALUES(3);	-- ok
INSERT INTO testschema.atable VALUES(1);	-- fail (checks index)
ERROR:  duplicate key value violates unique constraint "anindex"
DETAIL:  Key (column1)=(1) already exists.
SELECT COUNT(*) FROM testschema.atable;		-- checks heap
 count 
-------
     3
(1 row)

-- Will fail with bad path
CREATE TABLESPACE badspace LOCATION '/no/such/location';
ERROR:  Postgres-XC does not support TABLESPACE yet
DETAIL:  The feature is not currently supported
-- No such tablespace
CREATE TABLE bar (i int) TABLESPACE nosuchspace;
ERROR:  tablespace "nosuchspace" does not exist
-- Fail, not empty
DROP TABLESPACE testspace;
ERROR:  tablespace "testspace" does not exist
DROP SCHEMA testschema CASCADE;
NOTICE:  drop cascades to table testschema.atable
-- Should succeed
DROP TABLESPACE testspace;
ERROR:  tablespace "testspace" does not exist
